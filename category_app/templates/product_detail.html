{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load specifications %}
{% block content %}

<head>
<style>
    .rating {
  overflow: hidden;
  vertical-align: bottom;
  display: inline-block;
  width: 155px;
  height: 30px;
}

.rating > input {
  opacity: 0;
  margin-right: -100%;
}

.rating > label {
  position: relative;
  display: block;
  float: right;
  background: url('..css/images/star-off-big.png');
  background-size: 30px 30px;
}

.rating > label:before {
  display: block;
  opacity: 0;
  content: '';
  width: 30px;
  height: 30px;
  background: url('..css/images/star-on-big.png');
  background-size: 30px 30px;
  transition: opacity 0.2s linear;
}

.rating > label:hover:before,  .rating > label:hover ~ label:before,  .rating:not(:hover) > :checked ~ label:before { opacity: 1; }
</style>
    </head>
<hr>

<!--сообщение об успешном добавлении товара в избранные-->
<div class="container">
{% if messages %}
<div class="alert alert-warning" alert {{ message.tags }} role="alert">
{% for message in messages  %}
  {{message|safe}} - <a href="{% url 'favourite_list' %}" class="alert-link">Your favourites</a>.
{% endfor %}
</div>
</div>
{% endif %}

    <nav aria-label="breadcrumb" class="mt-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'base' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{{ product.category.get_absolute_url }}"></a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ product.title }}</li>
    </ol>
</nav>
<div class="row">
    <div class="col-md-4">
        <img src="{{ product.image.url }}" class="img-fluid">
    </div>
    <div class="col-md-8">
        <h3>{{ product.title }}</h3>
        <p>Price: {{product.price }} $</p>
        <p>Description: {{product.description }}</p>
        <hr>

<!--рейтинг-->
<li>
    <form action="{% url 'add_rating' %}" method="post" name="rating">
        <b>Rating</b>
        {% csrf_token %}
        <input type="hidden" value="{{ product.id }}" name="product">
        <span class="rating">
            {% for k, v in star_form.fields.star.choices %}
                <input id="rating{{ v }}" type="radio" name="star"
                       value="{{ k }}">
                <label for="rating{{ v }}">{{ k }}</label>
            {% endfor %}
        </span>
        <span class="editContent">4.0</span>
    </form>
</li>

<!--кнопка добавления в избранное-->
<a href="{% url 'favourite_add' product.id %}" class="btn btn-light fw500" role="button" aria-disabled="true">Add to favorites</a>

<hr>
<!--кнопка добавления товара в корзину      -->
<a href="{% url 'add_to_cart' ct_model=ct_model slug=product.slug %}"><button class="btn btn-danger">Add to cart</button></a>
</div>

<!--характеристики товара-->
<p class="mt-4">Specification:</p>

{{ product|product_spec }}

<!--добавление и просмотр отзывов-->
{% if request.user.is_authenticated %}

<div class="row">
    <div class="single-form-left">
        <!-- contact form grid -->
        <div class="contact-single">
            <h3 class="editContent">
                <span class="sub-tittle editContent"></span>Your review</h3>
            <form action="{% url 'add_review' product.id %}" method="post" class="mt-4" id="formReview">
                {% csrf_token %}
                <input type="hidden" name="parent" id="contactparent" value="">
                <div class="form-group editContent">
                    <label for="contactcomment" class="editContent">
                        Your review *
                    </label>
                    <textarea class="form-control border" rows="5" name="text"
                              id="contactcomment" required=""></textarea>
                </div>
                <div class="d-sm-flex">
                    <div class="col-sm-6 form-group p-0 editContent">
                        <label for="contactusername" class="editContent">
                            Name *
                        </label>
                        <input type="text" class="form-control border" name="name"
                               id="contactusername" required="">
                    </div>
                    <div class="col-sm-6 form-group ml-sm-3 editContent">
                        <label for="contactemail" class="editContent">
                            Email *
                        </label>
                        <input type="email" class="form-control border" name="email"
                               id="contactemail" required="">
                    </div>
                    <hr>
                    <div class="col-sm-6 form-group ml-sm-3 editContent">
                        <label for="contactfile" class="editContent">
                            File *
                        </label>
                        <input type="file" class="form-control border" name="file"
                               id="contactfile" required="">
                    </div>
                </div>
                <button type="submit"
                        class="mt-3 btn btn-success btn-block py-3">
                    Send
                </button>
            </form>
        </div>
        <!--  //contact form grid ends here -->
    </div>
</div>

<!--запрет на добавление отзывов незарегистрирвонным пользователям-->
{% else %}
<h3>To add a review, you need to log in or register.</h3>
{% endif %}

<!--отображение отзывов-->
{% for review in product.get_review %}

<div class="container"></div>
<div class="media py-5">
    <div class="media-body mt-4">
        <h5 class="mt-0 editContent">
            {{ review.name }}
        </h5>
        <p class="mt-2 editContent">
            {{ review.text }}
        </p>
        <a href="#formReview" onclick="addReview('{{ review.name }}', '{{ review.id }}')">Reply</a>
        {% for rew in review.reviews_set.all %}
        <div class="media mt-5 editContent">
            <a class="pr-3" href="#">
                <img src="" class="img-fluid " alt="image">
            </a>
            <div class="media-body">
                <h5 class="mt-0 editContent">{{ rew.name }}</h5>
                <p class="mt-2 editContent">{{ rew.text }}</p>
            </div>
        </div>
{% endfor %}
    </div>
</div>
{% endfor %}
</div>

<script>
    function addReview(name, id) {
        document.getElementById("contactparent").value = id;
        document.getElementById("contactcomment").innerText = `${name}, `
    }
</script>


{% endblock content %}