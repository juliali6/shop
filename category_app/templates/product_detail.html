{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load specifications %}
{% block content %}
    <nav aria-label="breadcrumb" class="mt-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'base' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{{ product.category.get_absolute_url }}"></a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ product.title }}</li>
    </ol>
</nav>
<div class="row">
    <div class="col-md-4">
        <img src="{{ product.image.url }}" class="img-fluid">
    </div>
    <div class="col-md-8">
        <h3>{{ product.title }}</h3>
        <p>Price: {{product.price }} $</p>
        <p>Description: {{product.description }}</p>
        <hr>
        <a href="{% url 'add_to_cart' ct_model=ct_model slug=product.slug %}"><button class="btn btn-danger">Add to cart</button></a>
    </div>
    <p class="mt-4">Specification:</p>

    {{ product|product_spec }}

    {% if request.user.is_authenticated %}

        <div class="row">
            <div class="single-form-left">
                <!-- contact form grid -->
                <div class="contact-single">
                    <h3 class="editContent">
                        <span class="sub-tittle editContent"></span>Your review</h3>
                    <form action="{% url 'add_review' product.id %}" method="post" class="mt-4" id="formReview">
                        {% csrf_token %}
                        <input type="hidden" name="parent" id="contactparent" value="">
                        <div class="form-group editContent">
                            <label for="contactcomment" class="editContent">
                                Your review *
                            </label>
                            <textarea class="form-control border" rows="5" name="text"
                                      id="contactcomment" required=""></textarea>
                        </div>
                        <div class="d-sm-flex">
                            <div class="col-sm-6 form-group p-0 editContent">
                                <label for="contactusername" class="editContent">
                                    Name *
                                </label>
                                <input type="text" class="form-control border" name="name"
                                       id="contactusername" required="">
                            </div>
                            <div class="col-sm-6 form-group ml-sm-3 editContent">
                                <label for="contactemail" class="editContent">
                                    Email *
                                </label>
                                <input type="email" class="form-control border" name="email"
                                       id="contactemail" required="">
                            </div>
                            <hr>
                            <div class="col-sm-6 form-group ml-sm-3 editContent">
                                <label for="contactfile" class="editContent">
                                    File *
                                </label>
                                <input type="file" class="form-control border" name="file"
                                       id="contactfile" required="">
                            </div>
                        </div>
                        <button type="submit"
                                class="mt-3 btn btn-success btn-block py-3">
                            Send
                        </button>
                    </form>
                </div>
                <!--  //contact form grid ends here -->
            </div>
        </div>


    {% else %}
    <h3>To add a review, you need to log in or register.</h3>
    {% endif %}

        {% for review in product.get_review %}

    <div class="container"></div>

            <div class="media py-5">
                <img src="{{ profile.avatar.url }}" class="mr-3 img-fluid" alt="image">
                <div class="media-body mt-4">
                    <h5 class="mt-0 editContent">
                        {{ review.name }}
                    </h5>
                    <p class="mt-2 editContent">
                        {{ review.text }}
                    </p>

    {% if review.file %}
        <div><a href="{{ review.file.file.url }}" target="_blank"><img src="{{ review.file.file.url }}" alt="" width="350px" height="350px"></a></div>
    {% endif %}
                    <a href="#formReview" onclick="addReview('{{ review.name }}', '{{ review.id }}')">Reply</a>
                    {% for rew in review.reviews_set.all %}
                    <div class="media mt-5 editContent">
                        <a class="pr-3" href="#">
                            <img src="{ media/ }" class="img-fluid " alt="image">
                        </a>
                        <div class="media-body">
                            <h5 class="mt-0 editContent">{{ rew.name }}</h5>
                            <p class="mt-2 editContent">{{ rew.text }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
<script>
    function addReview(name, id) {
        document.getElementById("contactparent").value = id;
        document.getElementById("contactcomment").innerText = `${name}, `
    }
</script>


{% endblock content %}